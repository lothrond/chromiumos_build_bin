========================
chromiumos_build_bin
========================

Chromium OS build helper scripts.

--------------
 Requirements 
--------------

 o RAM: 8-16GB
 o Disk Space: 135-250GB
 o Network: (decent speed)
 o (google account)

--------------
 Manual Setup
--------------

  00. Start by cloning this repository into ~/bin:
        $ git clone https://github.com/lothrond/chromiumos_build_bin ~/bin

  01. Change into it:
        $ cd ~/bin

  02. Source build ENVIRONMENT for host:
        $ source ./environment/host.sh

      (Consider adding to your .bashrc)

  03. Install git and curl (and lvm tools):
        $ ./setup/install_git_and_curl.sh

  04. Configure git:
        $ ./setup/configure_git.sh

  05. Tweak the sudoers config file:
        $ ./setup/tweak_sudoers_config.sh

  06. Install depot_tools:
        $ ./setup/install_depot_tools.sh

  07. Setup gerrit code review, (see docs/README-GERRIT).

  08. Get the source code:
        $ ./setup/source_checkout.sh

  09. Setup google API keys, (see docs/README-APIKEYS).

  10. Setup authorization for google storage buckets, (see docs/README-GSBUCKETS).

--------------
 Manual Build
--------------

  00. Make sure you either:
        a) have ~/.googleapikeys populated correctly
        b) supply API keys at runtime in /etc/chrome_dev.conf

  01. Share directories with the chroot, (see docs/README-SHARING):
        $ ./setup/local_mounts.sh

      (After running this command, you should have ~/bin inside of your chroot.)

  02. Create chroot:
        $ cd ${SOURCE_REPO} && cros_sdk

      ** This will take some time.

      When the previous command finishes, you should now be in the chroot, indicated  with
      a bash prompt:
         (cr) $

      (The rest of this document assumes so.)

  03. Inside the chroot:

      Select your board (see docs/README-BOARDS):
        (cr) $ export BOARD=cyan

      Select your disk image build (test/dev/base):
        (cr) $ export IMAGE=test

      Select verified boot mode (on/off):
        (cr) $ export VERITY=off

     OR

      Source ENVIRONMENT for chroot:
        (cr) source ~/bin/environment/chroot.sh

      (This will only work after running ./setup/local_mounts.sh)

      ** This repository defaults to building base images, with verified boot, for cyan boards.

      ** If you would like to build for another board, you will need to modify environment/chroot.sh 
         before buidling the image.

  4. Build Chromium OS:
       (cr) $ crosbuild new

  5. Flash Chromium OS on to a usb stick.
       (cr) $ flash_image_usb

     **WARNING: this will of course format the usb stick**

---------
 Testing
---------

  (Make sure you are in this directory):

  0. Mount:
       (cr) $ ./mount_disk_image

  1. (Test)

  2. Unmount:
       (cr) $ ./unmount_disk_image

---------
 Install
---------

  00. Make sure the Chrome OS device is in developer mode (see docs/README-DEVMODE).

---

 Note: You will still be able to recover Chome OS with recovery media.

  This tutorial assumes you are currently in a normal Chrome OS device.

   o Start by backing up, etc.

   o Then, make sure all external devices, usbs, sd, etc., are all unmounted and removed.

---

  01. Put the device in recovery mode:
       [esc]+[refresh] + [power]

  02. From recovery mode, put the device in developer mode:
       [ctrl]+[d]

      **WARNING: This is going to wipe your disk**

      This will format your device, then reboot to recovery.
      The default timeout is 30 seconds.

  03. Let the recovery timeout, or try pressing: [ctrl]+[d] to boot into developer mode. 

  04. You should now be on the setup screen. From this screen just switch to a tty with:
       [ctrl]+[alt]+[f2] (the forward button)

  05. You should now be in tty2. Login as chronos (you should not need a password).

  06. To be able to boot from usb media run:
       sudo crossystem dev_boot_usb=1

  07. Reboot to to recovery.

  08. Plugin usb.

  09. This time, press: [ctrl]+[u] to boot from usb media.

      (Chromium boot splash...)

  10. Repeat step 4.

  11. Login as the shared user chronos, and supply your password.

  12. Install Chromium OS onto device:
        /usr/sbin/chromeos-install

      (Press y if you agree)

      This will not take very long. 
      After this is done, i believe the rest should be self explanitory...

